---
title: "Casos prácticos"
---

## Análisis de veredas con potencial de riego

1. Seleccione veredas con proximidad a canales.
2. Combine indicadores productivos y accesibilidad.

```sql
WITH canales AS (
  SELECT geom
  FROM ref.canales_distrito_riego
),
veredas AS (
  SELECT vereda_codigo,
         municipio,
         geom,
         ST_Area(geom) / 10000 AS area_ha
  FROM stg.veredas_norm
)
SELECT v.vereda_codigo,
       v.municipio,
       v.area_ha,
       MIN(ST_Distance(v.geom, c.geom)) AS distancia_canal_m
FROM veredas v
CROSS JOIN canales c
GROUP BY v.vereda_codigo, v.municipio, v.area_ha
HAVING MIN(ST_Distance(v.geom, c.geom)) < 1500
ORDER BY distancia_canal_m;
```

Integre resultados en QGIS para producir mapas temáticos.

## Monitoreo de cambios interanuales

```sql
WITH veredas_2024 AS (
  SELECT vereda_codigo, geom FROM hist.veredas_norm_2024
),
veredas_2025 AS (
  SELECT vereda_codigo, geom FROM stg.veredas_norm
)
SELECT v25.vereda_codigo,
       ST_Area(ST_SymDifference(v24.geom, v25.geom)) / 10000 AS delta_ha
FROM veredas_2024 v24
JOIN veredas_2025 v25 USING (vereda_codigo)
WHERE NOT ST_Equals(v24.geom, v25.geom)
ORDER BY delta_ha DESC;
```

## Exportes QA automáticos

Combine scripts SQL con `psql` y `COPY` para generar reportes.

```bash
psql -d sig_fedearroz_fna -c "\COPY (
  SELECT vereda_codigo, municipio, area_ha
  FROM stg.veredas_norm
  ORDER BY municipio, vereda_codigo
) TO 'reportes_cartografia/QA_veredas_$(date +%Y%m%d).csv' CSV HEADER"
```

## Integración con Python y GeoPandas

```python
import geopandas as gpd
import sqlalchemy as sa

eninge = sa.create_engine("postgresql+psycopg://usuario@localhost/sig_fedearroz_fna")
veredas = gpd.read_postgis(
    "SELECT vereda_codigo, municipio, geom FROM stg.veredas_norm",
    eninge,
    geom_col="geom"
)
veredas.plot(column="municipio", figsize=(10, 8))
```

Documenta los cuadernos asociados dentro de `docs/notebooks/` y enlázalos desde este capítulo.
